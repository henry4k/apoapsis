include_rules

CFLAGS += @(LUA_CFLAGS)

: lua_cjson.c |> !cc |> %B.o {objects}
: strbuf.c |> !cc |> %B.o {objects}

ifeq (@(MULTITHREADED),y)
    CFLAGS += -DUSE_INTERNAL_FPCONV
    CFLAGS += -DMULTIPLE_THREADS
    CFLAGS += -pthread
    # apoapsis should use -pthread in the LDFLAGS too!
    # But this feature is unused at the moment.
    : g_fmt.c |> !cc |> %B.o {objects}
    : dtoa.c |> !cc |> %B.o {objects}
else
    : fpconv.c |> !cc |> %B.o {objects}
endif

: {objects} |> !ar |> lua-cjson.a
